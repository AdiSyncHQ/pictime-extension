<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Pic-Time Sniffer</title>

    <!-- CSS ONLY ‚Äî completely safe -->
    <link rel="stylesheet" href="popup.css" />
  </head>

  <body>
    <div class="shell">
      <div class="shell-inner">
        <!-- Dark Mode Toggle -->
        <button id="darkToggle" aria-label="Toggle dark mode">üåô</button>

        <header class="app-header">
          <div class="app-badge">PT</div>
          <div class="app-title-block">
            <h2>Pic-Time Sniffer</h2>
            <p class="subtitle">Gallery capture & transfer cockpit</p>
          </div>
        </header>

        <div id="status">Waiting to capture...</div>

        <div class="section">
          <div class="section-label">Pic-Time Dashboard URL</div>
          <div class="url-input">
            <div class="url-input-prefix">Subdomain</div>
            <div class="url-input-main">
              <input id="subdomainInput" type="text" placeholder="pictime domain" />
              <span>.pic-time.com/professional#dash</span>
            </div>
          </div>

          <button id="startBtn">Start Capture</button>
        </div>

        <div class="toolbar">
          <button id="refreshBtn">
            <span class="icon">üîÅ</span>
            <span>Sync Galleries</span>
          </button>
          <button id="clearBtn">
            <span class="icon">üßπ</span>
            <span>Clear History</span>
          </button>
        </div>

        <!-- Bulk transfer + delay -->
        <div class="section">
          <div class="section-label">Bulk transfer</div>

          <div class="bulk-row" style="display:flex; gap:8px; align-items:center;">
            <button
              id="transferAllBtn"
              class="btn-secondary"
              style="flex:1;"
            >
              Transfer all galleries
            </button>

            <div class="delay-col" style="display:flex; flex-direction:column; gap:2px; width:120px;">
              <label
                for="delayInput"
                style="font-size:11px; color:#9ca3af;"
              >
                Delay per image (ms)
              </label>
              <input
                id="delayInput"
                type="number"
                min="0"
                step="100"
                value="0"
                style="width:100%; padding:4px 6px; font-size:12px;"
              />
            </div>
          </div>

          <div class="note">
            Set a delay between image uploads to reduce captchas. 0 = no delay.
          </div>
        </div>

        <!-- Transfer Panel -->
        <div id="transferPanel">
          <div id="transferTitle">Transfer status</div>
          <div id="transferBarContainer"><div id="transferBar"></div></div>
          <div id="transferProgress"></div>
        
          <!-- NEW: ETA line -->
          <div id="transferEta" class="transfer-eta" style="font-size:12px; color:#6b7280; margin-top:2px;"></div>
        
          <div id="transferFailures"></div>
          <button id="clearTransferBtn">‚ú® Clear transfer log</button>
        </div>
        <!-- Last run summary (only used when no active transfer) -->
<!-- Last run summary ‚Äì redesigned -->
<div id="lastRunContainer" class="section last-run">
  <div id="lastRunHeader" class="last-run-header">
    <div class="lr-title">
      <span class="lr-dot"></span>
      Last transfer summary
    </div>
    <span id="lastRunChevron" class="lr-chevron">‚ñæ</span>
  </div>

  <div id="lastRunBody" class="last-run-body">
    <div id="lastRunText" class="lr-text"></div>
    <div id="lastRunFailuresList" class="lr-failures"></div>

    <div class="lr-btn-row">
      <button id="retryFailedBtn" class="btn-secondary lr-btn">Retry failed</button>
      <button id="clearLastRunBtn" class="btn-secondary lr-btn">Clear summary</button>
    </div>
  </div>
</div>


        <div class="galleries-header">
          <div class="galleries-title">Captured Galleries</div>
        </div>

        <div id="galleries"></div>
      </div>
    </div>
    <div id="advancedToggle">
  Advanced options ‚ñæ
</div>

<div id="advancedPanel">
    <div style="margin-bottom:8px; font-size:12px; color:#4b5563;">
        Backend auth key
      </div>
      <input
        id="authTokenInput"
        type="password"
        placeholder="Paste secret key"
      />
      <button
        id="saveAuthBtn"
      >
        üíæ Save backend auth key
      </button>

  <button id="debugClearStorage">
    ‚ö†Ô∏è Clear Extension Cache
  </button>
</div>


    <div id="toast"></div>
    

    <!-- EXTERNAL JS ONLY ‚Äî REQUIRED FOR CSP -->
    <script src="popup.js"></script>
    <script src="ui.js"></script>
  </body>
</html>
