<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Pic-Time Sniffer</title>
    <link rel="stylesheet" href="popup.css" />
  </head>

  <body>
    <div class="shell">
      <div class="shell-inner">
        <button id="darkToggle" aria-label="Toggle dark mode">üåô</button>

        <header class="app-header">
          <div class="app-badge">PT</div>
          <div class="app-title-block">
            <h2>Pic-Time Sniffer</h2>
            <p class="subtitle">Gallery capture & transfer cockpit</p>
          </div>
        </header>

        <div id="status">Waiting to capture...</div>

        <div class="section">
          <div class="section-label">Pic-Time Dashboard URL</div>
          <div class="url-input">
            <div class="url-input-prefix">Subdomain</div>
            <div class="url-input-main">
              <input id="subdomainInput" type="text" placeholder="pictime domain" />
              <span>.pic-time.com/professional#dash</span>
            </div>
          </div>
          <button id="startBtn">Start Capture</button>
        </div>

        <div class="toolbar">
          <button id="refreshBtn">
            <span class="icon">üîÅ</span>
            <span>Sync Galleries</span>
          </button>
          <button id="clearBtn">
            <span class="icon">üßπ</span>
            <span>Clear History</span>
          </button>
        </div>

        <div class="section">
          <div class="section-label">Batch Operations</div>
          <div class="bulk-row" style="display:flex; gap:8px; align-items:center;">
            <button
              id="transferSelectedBtn"
              class="btn-secondary"
              style="flex:1;"
              disabled
            >
              Select galleries...
            </button>

            <div class="delay-col" style="display:flex; flex-direction:column; gap:2px; width:120px;">
              <label
                for="delayInput"
                style="font-size:11px; color:#9ca3af;"
              >
                Delay per image (ms)
              </label>
              <input
                id="delayInput"
                type="number"
                min="0"
                step="100"
                value="0"
                style="width:100%; padding:4px 6px; font-size:12px;"
              />
            </div>
          </div>
          <div class="note">
            Set a delay to reduce captchas. 0 = no delay.
          </div>
        </div>

        <div id="transferPanel">
          <div id="transferTitle">Transfer status</div>
          <div id="transferBarContainer"><div id="transferBar"></div></div>
          
          <div class="transfer-controls" style="display:flex; justify-content:space-between; align-items:flex-start;">
             <div>
                <div id="transferProgress"></div>
                <div id="transferEta" class="transfer-eta" style="font-size:12px; color:#6b7280; margin-top:2px;"></div>
             </div>
             <button id="pauseResumeBtn" class="btn-secondary" style="min-width:70px;">Pause</button>
          </div>

          <div id="transferFailures"></div>
          <button id="clearTransferBtn">‚ú® Clear transfer log</button>
        </div>

        <div id="lastRunContainer" class="section last-run">
          <div id="lastRunHeader" class="last-run-header">
            <div class="lr-title">
              <span class="lr-dot"></span>
              Last transfer summary
            </div>
            <span id="lastRunChevron" class="lr-chevron">‚ñæ</span>
          </div>

          <div id="lastRunBody" class="last-run-body" style="display: none;">
            <div id="lastRunText" class="lr-text"></div>
            <div id="lastRunFailuresList" class="lr-failures"></div>

            <div class="lr-btn-row">
              <button id="retryFailedBtn" class="btn-secondary lr-btn">Retry failed</button>
              <button id="downloadLogBtn" class="btn-secondary lr-btn" style="display:none;">‚¨á Log</button>
              <button id="clearLastRunBtn" class="btn-secondary lr-btn">Clear summary</button>
            </div>
          </div>
        </div>

        <div class="galleries-header">
          <div class="galleries-title">Captured Galleries</div>
          <div class="select-all-wrap">
            <input type="checkbox" id="selectAllBox" />
            <label for="selectAllBox">Select All</label>
          </div>
        </div>

        <div id="galleries"></div>
      </div>
    </div>

    <div id="advancedToggle">Advanced options ‚ñæ</div>

    <div id="advancedPanel">
      <div style="margin-bottom:4px; font-size:12px; color:#4b5563;">
        Upload Concurrency (1-10)
      </div>
      <input
        id="concurrencyInput"
        type="number"
        min="1"
        max="10"
        value="6"
        style="width:100%; padding:6px 8px; border-radius:8px; border:1px solid #d1d5db; font-size:12px; margin-bottom:12px;"
      />

      <div style="margin-bottom:8px; font-size:12px; color:#4b5563;">
        Backend auth key
      </div>
      <input
        id="authTokenInput"
        type="password"
        placeholder="Paste secret key"
      />
      <button id="saveAuthBtn">üíæ Save backend auth key</button>

      <button id="debugClearStorage">‚ö†Ô∏è Clear Extension Cache</button>
    </div>

    <div id="toast"></div>

    <script src="popup.js"></script>
    <script src="ui.js"></script>
  </body>
</html>